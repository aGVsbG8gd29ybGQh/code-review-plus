# Code Review Plus - 智能代码评审助手

<div align="center">

![Plugin Icon](images/pluginIcon.svg)

**致力于让代码评审更轻松**

一款 IntelliJ IDEA 插件，通过会话管理、增量评审、自动化规则和评论系统，帮助你高效完成代码评审

[![Version](https://img.shields.io/badge/version-3.0.0-blue.svg)](https://plugins.jetbrains.com/plugin/XXXXX)
[![IDEA Version](https://img.shields.io/badge/IDEA-2025.2+-orange.svg)](https://www.jetbrains.com/idea/)

</div>

---

## 目录

- [为什么需要 Code Review Plus](#为什么需要-code-review-plus)
- [核心功能](#核心功能)
- [免费与付费](#免费与付费)
- [安装](#安装)
- [快速开始](#快速开始)
- [使用指南](#使用指南)
- [自动评审规则 [Premium]](#自动评审规则-premium)
- [评审报告导出与导入](#评审报告导出与导入)
- [插件设置](#插件设置)
- [最佳实践](#最佳实践)
- [常见问题](#常见问题)
- [版权与反馈](#版权与反馈)

---

## 为什么需要 Code Review Plus

代码评审中经常遇到这些痛点：

- **评审到一半被打断**，回来后忘了哪些看过、哪些没看
- **分支又有新提交**，不确定之前评审过的部分是否还有效，只能从头再来
- **变更文件太多**，想分批评审但无法记录进度
- **想标记一些问题**，但又不想在 PR 上留一堆杂乱的评论
- **大量无意义的变更消耗精力**，import 调整、代码格式化、空行增删……这些变更夹杂在真正的业务代码中，你不得不逐个确认它们"没有问题"，评审时间被大量浪费在噪音上

Code Review Plus 解决这些问题的方式很简单：**在 IDEA 里直接跟踪评审进度，并用自动化规则过滤噪音**。

你评审过的每一块代码、标记的每一个状态、写下的每一条评论，都会自动保存在本地。分支更新后，系统智能识别哪些代码变了、哪些没变，你只需要关注新增和修改的部分。对于 import 变更、格式化调整这类无意义的改动，以及硬编码密钥、调试代码残留这类明显的问题，自动评审规则会帮你一键处理，让你把时间花在真正需要思考的代码上。

### 谁适合使用

**开发者**：在提交代码给测试或评审人员之前，用它做一次自查。创建评审会话，逐个检查自己的代码变更，甚至可以边开发边 review——每完成一部分就标记一部分，避免最后集中评审时遗漏细节。

**评审人员**：面对大量变更文件时，用自动评审先过滤噪音，然后分批次评审，进度随时保存不怕中断。发现问题直接写评论，评审完成后导出报告发给开发者，让对方在 IDEA 中逐条查看和修复，省去来回沟通的成本。

---

## 核心功能

### 会话管理

选择评审分支和基准分支，创建一个评审会话。插件会计算两个分支之间的所有差异，列出变更文件和代码块。

- 会话数据自动保存在本地，IDEA 重启后自动恢复
- 同一个项目可以同时管理多个评审会话
- 不同项目的评审数据互相独立

### 状态跟踪

为每个代码变更块（Diff Block）标记评审状态：


|                                     图标                                      | 状态   | 含义    | 使用场景          |
|:---------------------------------------------------------------------------:|------|-------|---------------|
| <img src="images/gutterCheckBoxSelected_gray_1.svg" width="16" height="16"> | 未评审  | 尚未处理  | 默认状态，等待评审     |
| <img src="images/gutterCheckBoxSelected_green.svg" width="16" height="16">  | 通过   | 代码没问题 | 确认代码符合预期      |
|            <img src="images/warning.svg" width="16" height="16">            | 问题   | 需要关注  | 发现问题或需要讨论     |
|        <img src="images/lightning_green.svg" width="16" height="16">        | 自动通过 | 代码没问题 | 自动评审已确认代码符合预期 |
|        <img src="images/lightning_orange.svg" width="16" height="16">         | 自动问题 | 需要关注  | 自动评审发现问题或需要讨论 |

前三种状态为手动标记：在 Diff 视图中点击代码行号旁的图标即可循环切换（未评审 → 通过 → 问题 → 未评审）。后两种状态由自动评审规则标记，不能手动设置。代码块的状态会自动汇总到文件级别，文件列表中直观显示每个文件的整体评审情况。

### 增量评审

分支有新提交后，点击刷新按钮，系统会重新计算差异并与上一次的评审状态进行智能匹配：


| 场景     | 处理方式           |
|--------|----------------|
| 代码完全没变 | 保留之前的评审状态和评论   |
| 代码有修改  | 重置为未评审，评论标记为悬浮 |
| 新增的代码  | 标记为未评审         |
| 被删除的代码 | 自动清理           |

这意味着你不需要从头开始——只需要继续评审变更的部分。

### 评论系统

在 Diff 视图中为代码添加文字评论，记录发现的问题和改进建议。

**评论状态**：


|                                图标                                 | 状态   | 含义         |
|:-----------------------------------------------------------------:|------|------------|
|   <img src="images/comment_orange.svg" width="16" height="16">    | 待处理  | 需要开发者关注的问题 |
| <img src="images/comment_light_green.svg" width="16" height="16"> | 无需处理 | 确认不需要修改    |
|    <img src="images/comment_green.svg" width="16" height="16">    | 已处理  | 问题已修复      |

**悬浮评论**：当关联的代码块在分支更新后发生变化，评论会被保留但标记为"悬浮"。你仍然可以查看评论创建时的原始代码。

### 自动评审 [Premium]

基于预定义规则，自动为代码块标记评审状态。例如：

- 仅修改了空格或空行的代码块 → 自动标记为"通过"
- 新增了 `import *` 语句 → 自动标记为"问题"
- 检测到硬编码密钥 → 自动标记为"问题"

自动评审帮助你跳过无关紧要的变更，聚焦真正需要关注的代码。规则可以在设置中自由启用和禁用。

### 报告导出与导入

将评审结果导出为 HTML 格式的报告，包含评审进度、代码差异和所有评论。报告可以发送给分支的开发者，开发者通过导入报告直接在自己的 IDEA 中查看评审人留下的评论，逐个定位和修复问题。

推荐的协作方式：**评审人标记问题 → 导出报告 → 开发者导入报告 → 查看评论并修复 → 通知评审人确认**，形成评审流程的闭环。

---

## 免费与付费

Code Review Plus 采用 Freemium 模式：**当前仅自动评审功能需要许可证**，其余所有功能（会话管理、状态跟踪、增量评审、评论系统、报告导出与导入等）均免费使用。

我们承诺：**现有的免费功能会一直免费，后续不会添加许可证限制**，你可以放心使用。

自动评审功能从 JetBrains Marketplace 安装插件后自动获得 30 天试用期。到期后如希望继续使用，可在 Marketplace 购买许可证。如果希望有更久的体验期，请通过邮件告知我们原因，我们将酌情提供免费许可证。

---

## 安装

### 系统要求

- IntelliJ IDEA 2025.2 或更高版本（社区版和旗舰版均支持）
- Git 插件（IDEA 内置，无需额外安装）
- 操作系统：Windows / macOS / Linux

### 从 JetBrains Marketplace 安装（推荐）

1. 打开 IDEA，进入 `Settings` → `Plugins`
2. 选择 `Marketplace` 标签
3. 搜索 **Code Review Plus**
4. 点击 `Install`，安装完成后重启 IDEA

建议始终通过 Marketplace 安装并保持插件为最新版本。Marketplace 会自动推送更新通知，确保你使用的是最稳定的版本。

### 手动安装

1. 下载插件 `.zip` 文件
2. 打开 IDEA，进入 `Settings` → `Plugins`
3. 点击齿轮图标 → `Install Plugin from Disk...`
4. 选择下载的 `.zip` 文件，重启 IDEA

### 关于版本回退

**请勿回退到旧版本。** 插件的数据库结构会随版本升级而变化，回退到旧版本可能导致插件无法正常启动，并造成不可恢复的数据损坏和评审数据丢失。如果当前版本遇到问题，请通过反馈渠道联系我们，而不是回退版本。

---

## 快速开始

### 1. 打开工具窗口

安装完成后，在 IDEA 左侧工具栏找到 **Code Review Plus** 图标并点击。

也可以通过菜单 `View`（视图） → `Tool Windows`（工具窗口） → `Code Review Plus` 打开。

### 2. 创建评审会话

通过以下任一方式打开创建会话对话框：

1. **工具窗口**：点击工具栏的 **+** 按钮 → `New Session...`（新建会话）
2. **菜单栏**：`Tools` → `Code Review Plus` → `Start Review...`（快捷键 `Ctrl+Shift+R` / macOS `Cmd+Shift+R`）
3. **项目右键菜单**：`Code Review Plus` → `Start Review...`

在对话框中选择：

- **评审分支**：你要评审的 Feature 分支
- **基准分支**：对比基准，通常是 `master`

点击确定，插件会计算两个分支之间的所有差异。

**注意**：

- 创建评审会话时，评审分支必须包含基准分支的所有提交
- 本地如果有改动未提交或未推送，会有提示但不影响创建评审会话

### 3. 逐个评审代码块

在文件列表中双击文件，打开 Diff 视图。点击代码行号旁的状态图标，为每个代码块标记评审结果：

- 点击一次：未评审 → 通过
- 再点一次：通过 → 问题
- 再点一次：问题 → 未评审

### 4. 添加评论（可选）

在 Diff 视图中右键，选择 `Add Comment`（添加评论），为代码写下评论。评论会关联到对应的代码块，方便追踪。

### 5. 刷新会话

当评审分支有新的提交时，点击工具栏的刷新按钮。已评审的代码块会保留状态，你只需要关注新增或修改的部分。

### 6. 导出报告（可选）

评审完成后，点击工具栏的导出按钮，将评审结果保存为 HTML 报告。

---

## 使用指南

### 工具栏


| 按钮                                                    | 功能   | 说明                       |
|-------------------------------------------------------|------|--------------------------|
| <img src="images/add.svg" width="16" height="16">     | 创建会话 | 新建评审会话或从评审报告导入          |
| <img src="images/refresh.svg" width="16" height="16"> | 刷新会话 | 增量更新当前会话的差异数据            |
| <img src="images/delete.svg" width="16" height="16">  | 删除会话 | 删除当前会话及所有关联数据            |
| <img src="images/run.svg" width="16" height="16">     | 自动评审 | 对当前会话执行自动评审规则            |
| <img src="images/show.svg" width="16" height="16">    | 视图切换 | 在 Diff Block 列表和评论列表之间切换 |
| <img src="images/filter.svg" width="16" height="16">  | 状态筛选 | 按评审状态或变更类型筛选文件           |
| <img src="images/export.svg" width="16" height="16">  | 导出报告 | 将评审结果导出为 HTML 报告         |
| <img src="images/close.svg" width="16" height="16">   | 关闭会话 | 关闭当前会话但保留数据，可稍后恢复        |

### 状态筛选

**Diff Block 列表视图**下可按评审状态筛选：全部 / 未评审 / 通过 / 问题。

**评论列表视图**下可按评论状态筛选：待处理 / 无需处理 / 已处理，也可按变更类型筛选。

### 统计面板

工具窗口底部实时显示评审进度：

```
评审进度: 45/120 代码块 (37.5%)
  已确认: 40    问题: 5    未评审: 75
```

完成度计算公式：(已确认 + 问题) / 总数 × 100%

### 评论管理

**添加评论**：在 Diff 视图中右键 → `Add Comment`（添加评论）。支持选中多行代码作为评论范围，评论最多 500 字符。

**查看评论**：点击 Diff 视图 Gutter 区域的评论图标，或切换到评论列表视图集中查看。

**状态流转**：待处理 → 无需处理 / 已处理。在评论面板或评论列表中修改。

**批量操作**：在评论列表视图中，选中多个评论后右键批量更新状态。

**定位代码**：双击评论列表中的评论，自动跳转到 Diff 视图对应位置。

---

## 自动评审规则 [Premium]

自动评审通过预定义规则批量标记代码块状态，减少手动操作。在工具栏点击"自动评审"按钮执行。

### 内置规则

**自动通过规则**（符合条件时自动标记为"通过"）：


| 规则        | 说明                  | 默认状态 |
|-----------|---------------------|------|
| Import 变更 | 代码块仅包含 import 语句的增删 | 启用   |
| 空格变更      | 代码块仅包含空格、空行的变更      | 启用   |
| 注释变更      | 代码块仅包含注释的变更         | 启用   |
| 重命名       | 文件仅重命名/移动但内容不变      | 启用   |

**自动问题规则**（符合条件时自动标记为"问题"）：


| 规则          | 说明                                              | 默认状态 |
|-------------|-------------------------------------------------|------|
| 禁止 import * | 新增了通配符 import 语句                                | 启用   |
| 硬编码密钥检测     | 检测到硬编码的密码、API Key、Token 等                       | 启用   |
| 调试代码残留      | 检测到 `System.out.println`、`e.printStackTrace()` 等 | 启用   |
| TODO/FIXME  | 新增了 TODO、FIXME 等注释                              | 启用   |
| IDE 错误检查    | 利用 IDEA 内置检查发现的错误                               | 启用   |
| IDE 警告检查    | 利用 IDEA 内置检查发现的警告                               | 启用   |
| IDE 弱警告检查   | 利用 IDEA 内置检查发现的弱警告                              | 启用   |

### 规则配置

进入 `Settings` → `Tools` → `Code Review Plus`，在自动评审规则面板中：

- **全局开关**：启用/禁用整个自动评审功能
- **逐条启停**：为每条规则单独设置启用状态
- **跳过测试目录**：启用后自动跳过 `src/test/` 等测试目录
- **跳过文档文件**：启用后自动跳过 `.md`、`.txt` 等文档文件

### 规则执行逻辑

- 问题规则优先于通过规则执行
- 已手动标记的代码块不会被自动规则覆盖

---

## 评审报告导出与导入

导出与导入功能的设计初衷是打通评审人和开发者之间的协作链路。评审人完成评审后导出报告，开发者导入报告即可在自己的 IDEA 中看到所有评论并逐个修复。修复提交后，评审人拉取最新代码并刷新评审会话，即可确认问题是否已解决。

当然，你也可以单纯将报告用于存档或分享。

### 导出报告

1. 打开评审会话，点击工具栏的导出按钮
2. 在弹出对话框中选择导出范围和位置
3. 生成 HTML 格式的报告

报告内容包含：

- 评审进度统计（通过/问题/未评审的数量和比例）
- 变更文件列表和代码差异
- 评论内容及状态

**导出语言**：支持中文和英文，可在 `Settings` → `Tools` → `Code Review Plus` 中设置。

**导出目录**：支持两种模式：

- 相对路径模式：相对于项目根目录（默认）
- 固定路径模式：使用固定的绝对目录

### 导入报告

1. 开发者在自己的 IDEA 中打开同一个项目
2. 点击工具栏的 **+** 按钮，选择 **从评审报告导入**，然后选择评审人导出的 HTML 报告文件
3. 系统自动解析报告并创建评审会话，还原评审人标记的评论
4. 开发者在 Diff 视图中查看评论，定位并修复问题

导入会新增一个会话，不会影响本地创建的会话。

---

## 插件设置

进入 `Settings` → `Tools` → `Code Review Plus` 进行配置：


| 设置项               | 说明                                       | 默认值     |
|-------------------|------------------------------------------|---------|
| 报告导出语言            | 导出报告使用的语言                                | English |
| 添加评论时自动标记问题       | 添加评论时将关联的代码块自动标记为"问题"                    | 关闭      |
| 显示 Diff Block 工具栏 | 在 Diff 视图的每个代码块左侧显示操作工具栏，可快速切换diff block | 关闭      |
| 分支更新检测            | 自动检测远程分支是否有新提交并提醒                        | 开启      |
| 导出目录模式            | 选择相对路径或固定路径                              | 相对路径    |
| 自动评审规则配置          | 配置自动评审规则的启用状态和全局选项                       | 见上文     |

---

## 最佳实践

### 日常评审流程

**推荐的评审工作流**：

1. **创建会话** → 选择 Feature 分支和 master/develop 分支
2. **运行自动评审** → 让规则自动处理空格、import 等无关紧要的变更
3. **按文件逐个评审** → 从未评审的文件开始，双击打开 Diff 视图
4. **标记状态 + 写评论** → 通过的标记通过，有问题的标记问题并写评论
5. **定期刷新** → 分支有新提交时刷新，只需关注变更部分
6. **导出报告** → 评审完成后导出，可存档或发送给开发者导入查看

### 大型分支评审策略

当变更文件很多时：

1. **先运行自动评审**，过滤掉格式化、import 调整等噪音
2. **使用筛选功能**，先只看"未评审"的文件
3. **分批次评审**，每次评审一部分文件，进度会自动保存
4. **关注问题文件**，筛选出标记为"问题"的文件集中处理

### 配合开发者修复（推荐协作方式）

1. 评审完成后，**导出报告** 发给分支开发者
2. 开发者 **导入报告**，在自己的 IDEA 中查看评审评论
3. 开发者逐个查看评论，修复问题并提交新代码
4. 开发者通知评审人确认修复
5. 评审人 **刷新会话**，系统自动识别代码变更
6. 检查之前标记为"问题"的代码块是否已修复，确认后更新状态

### 效率提升技巧

- **开启"添加评论时自动标记问题"**：写评论时自动将代码块标记为"问题"，省去一次点击
- **善用评论列表视图**：集中查看所有评论，快速定位未处理的问题
- **定期清理悬浮评论**：代码更新后的悬浮评论如果已不再需要，及时删除
- **配置自动评审规则**：根据团队规范启用合适的规则，减少重复劳动

---

## 常见问题

### 插件如何识别代码变更是否已评审？

插件为每个代码块计算内容签名（基于代码位置和内容的 MD5）。刷新会话时，通过签名匹配识别：

- 签名一致 → 保留评审状态
- 签名变化 → 重置为未评审
- 新签名 → 标记为新增

### 刷新会话后评审状态和评论会丢失吗？

不会。代码未变更的部分完全保留状态和评论。代码有变化的部分，评审状态会重置为未评审，但评论会保留为悬浮评论，你仍然可以查看评论内容和当时的原始代码。

### 是否支持多人协作？

当前版本的评审数据存储在本地，不支持多人共享。如果需要团队协作评审，建议使用 GitHub/GitLab 的 PR 功能。Code Review Plus 更适合个人预评审、本地代码自查、或在本地完成评审后导出报告分享给团队。

### 删除会话会影响代码吗？

不会。删除会话只会清除评审数据（数据库记录），Git 仓库代码、分支历史、本地文件完全不受影响。

### 数据存储在哪里？

评审数据存储在项目目录下的 `.idea/code-review-plus.db`（SQLite 数据库）。这个文件通常在 `.gitignore` 中，不会被提交到版本控制。所有数据仅存储在本地，插件不依赖任何服务端接口，数据不会上传到任何服务器。

### 为什么创建会话时提示"分支未推送"？

插件使用 `git diff` 计算差异，评审分支和基准分支需要存在于远程仓库。请先 `git push` 相关分支。

### 评审状态和评论有什么区别？

评审状态标记在代码块级别（未评审/通过/问题），反映整体评审进度。评论是具体的文字说明（待处理/无需处理/已处理），记录发现的问题和建议。典型用法是：先标记代码块为"问题"，再添加评论说明具体原因。

### 什么是悬浮评论？

当评论关联的代码块在分支更新后发生变化或被删除，评论会变成"悬浮评论"。悬浮评论在界面上以半透明样式显示，你仍然可以查看评论内容和评论创建时的原始代码。可以手动删除不再需要的悬浮评论。

### IDEA 内置检查规则（Platform Error/Warning）是什么？

这三条规则利用 IDEA 平台内置的代码检查功能分析新增代码。它会调用 IDEA 已加载的所有检查器（包括第三方插件注册的检查，如 SonarLint），在新增的代码块上运行并报告问题。如果你安装了 SonarLint 等代码检查插件，它们的检查结果也可能被自动评审捕获。

### 插件对性能有影响吗？

影响极小。Diff 计算使用 Git 命令行，数据库操作基于轻量级 SQLite，UI 仅在打开工具窗口时加载。批量数据库操作和异步加载等优化确保插件不会拖慢 IDEA。

---

## 版权与反馈

**Code Review Plus** &copy; 2026 Zero. All Rights Reserved.

本插件为专有软件，详细许可条款请查看 LICENSE 文件。

### 问题反馈

如果使用过程中遇到问题或想提供建议，欢迎通过以下方式反馈：

- 邮件：zero_feedback@163.com

反馈时请提供 IDEA 版本、插件版本、操作系统信息和问题重现步骤。错误日志可通过 `Help` → `Show Log in Finder/Explorer` 获取。

### 第三方组件

本软件使用了以下开源组件：

- [Carbon Icons](https://github.com/carbon-design-system/carbon) (Apache 2.0) - UI 图标
- [IntelliJ Platform SDK](https://plugins.jetbrains.com/docs/intellij/welcome.html) (Apache 2.0) - 插件开发框架
- [SQLite JDBC](https://github.com/xerial/sqlite-jdbc) (Apache 2.0) - 数据库驱动

---

<div align="center">

**如果这个插件对你有帮助，欢迎在 Marketplace 给予好评**

Made with care by Zero

</div>
