# Code Review Plus

<div align="center">

**一款专为提升代码评审效率设计的 IntelliJ IDE 插件**

通过评审会话管理、状态跟踪、增量评审和评论系统，让分支评审工作变得简单高效。

[![Version](https://img.shields.io/badge/version-2.0.1-blue.svg)](https://plugins.jetbrains.com/plugin/XXXXX)
[![IDEA Version](https://img.shields.io/badge/IDEA-2025.2+-orange.svg)](https://www.jetbrains.com/idea/)
[![License](https://img.shields.io/badge/license-Proprietary-red.svg)]()

</div>

---

## 📖 目录

- [功能特性](#-功能特性)
- [核心优势](#-核心优势)
- [安装方法](#-安装方法)
- [快速开始](#-快速开始)
- [使用指南](#-使用指南)
- [适用场景](#-适用场景)
- [技术架构](#-技术架构)
- [常见问题](#-常见问题)
- [问题反馈](#-问题反馈)

---

## ✨ 功能特性

### 1 会话管理

评审进度自动保存到本地SQLite数据库，支持：

- 💾 **自动保存** - 每次状态变更实时持久化
- 🔄 **会话恢复** - IDEA重启后自动恢复上次活动会话
- 📁 **多项目支持** - 在同一IDEA实例中管理多个Git项目
- 📊 **多会话并行** - 同时管理多个评审分支

---

### 2 状态跟踪

为每个代码变更块标记评审状态，支持三种状态：

- [] **未评审** - 待处理的代码变更
- ✅ **通过** - 评审无问题
- ⚠️ **问题** - 需要关注或修改

**自动级联更新**：代码块状态变更时，自动重新计算文件状态，保持数据一致性。

---

### 3 增量评审支持

分支更新后智能合并新旧差异，**保留已评审状态**，只需评审新增或变更的代码。

**智能匹配策略**：
- ✅ **精确匹配** - 代码位置和内容完全一致，保留评审状态
- 🔄 **模糊匹配** - 代码内容变化但可追溯，保留评论但重置状态
- ➕ **新增识别** - 自动识别新增代码块
- ➖ **删除归类** - 清理已删除的代码块

---

### 4 Diff视图增强

在IDEA原生Diff视图中直接标记评审状态，无缝集成开发工作流：

- 🎨 **Gutter图标** - 在代码行号旁显示状态图标
- 🖱️ **一键切换** - 点击图标循环切换状态（未评审 → 通过 → 问题）
- 🌈 **背景高亮** - 已确认的代码块显示淡绿色背景
- 💬 **工具提示** - 悬停显示代码块详细信息

![Diff视图增强示例](docs/images/diff-view-enhanced.png)
> 📸 **截图说明**：Diff视图中的Gutter图标和背景高亮效果

---

### 5 可视化评审面板

提供直观的图形化界面，提升评审效率：

- 🌲 **树形文件列表** - 分层展示变更文件
- 🏷️ **状态图标** - 直观显示评审状态和变更类型
- 🔍 **智能筛选** - 按状态筛选文件（全部/未评审/通过/问题）
- 📈 **进度统计** - 实时显示评审完成度
- ⚡ **批量操作** - 支持文件级状态批量更新

---

### 6️ 代码评论系统

为代码评审提供完整的评论能力，支持问题标记和追踪：

- 💬 **Diff 窗口添加评论** - 右键菜单为任意代码行添加评论
- 🎨 **可视化评论图标** - Gutter 区域显示状态化图标（待处理/无需处理/已处理）
- 📝 **智能评论面板** - 查看评论、修改状态、回显原始代码
- 🔄 **悬浮评论机制** - 代码变更后评论仍保留，半透明标识
- 📋 **评论列表视图** - 按文件分组管理所有评论，支持筛选和批量操作
- 🎯 **精准定位** - 双击评论自动跳转到 Diff 窗口对应位置

**评论状态管理**：
- 🔵 **待处理** - 需要关注的问题或建议
- ✓ **无需处理** - 已确认无需修改的评论
- ● **已处理** - 已完成处理的评论

**智能特性**：
- 支持单行或多行代码范围评论
- 评论内容最多 500 字符，实时字符计数
- 通过 Git 历史回显评论创建时的代码内容
- 批量更新评论状态，高效管理评审进度

---

## 🎯 核心优势

### 🚀 告别重复评审

当评审分支有新提交时，插件会智能识别：
- ✅ 哪些代码已经评审过（保留状态）
- 🆕 哪些是新增或修改的（标记为未评审）

**避免重复劳动**，专注于真正需要关注的代码变更。

---

### 💾 状态持久化

评审进度实时保存到本地数据库：
- 不用担心IDEA崩溃导致进度丢失
- 不用担心误关闭工具窗口
- 支持跨会话恢复评审

---

### 🎨 原生体验

完全集成IDEA原生Diff视图：
- 无需切换界面，保持熟悉的操作习惯
- 支持所有Diff视图快捷键
- 自动跟随IDEA主题（Dark/Light）

---

### 💬 评论协作增强

专业的评论系统让问题追踪更高效：
- 为代码块添加详细评论，记录问题和建议
- 三种状态管理（待处理/无需处理/已处理），清晰追踪进度
- 悬浮评论机制，代码变更后评论不丢失
- 评论列表视图，集中管理所有评论
- 原始代码回显，即使代码已变更仍可查看评论时的上下文

---

## 📦 安装方法

### 方式一：通过JetBrains Marketplace安装（推荐）

1. 打开IDEA，进入 `Settings/Preferences` → `Plugins`
2. 点击 `Marketplace` 标签
3. 搜索 "**Code Review Plus**"
4. 点击 `Install` 安装
5. 重启IDEA

![安装步骤](docs/images/install-from-marketplace.png)
> 📸 **截图说明**：Marketplace搜索和安装界面

---

### 方式二：手动安装

1. 下载插件文件（`.zip` 格式）
2. 打开IDEA，进入 `Settings/Preferences` → `Plugins`
3. 点击设置图标 ⚙️ → `Install Plugin from Disk...`
4. 选择下载的 `.zip` 文件
5. 重启IDEA

---

### 系统要求

- **IDEA版本**: 2025.2 或更高版本
- **依赖插件**: Git4Idea（IDEA内置）
- **操作系统**: Windows / macOS / Linux

---

## 🚀 快速开始

### 第一步：打开工具窗口

通过以下任一方式打开工具窗口：

- **菜单栏**: `View` → `Tool Windows` → `Code Review Plus`
- **侧边栏**: 点击左侧工具栏的 `Code Review Plus` 图标

---

### 第二步：创建评审会话

1. 打开创建会话对话框
   - **菜单栏**: `Tools` → `Code Review Plus` → `Start Review...`
   - **项目右键菜单**: `Code Review Plus` → `Start Review...`
   - **工具窗口**: 点击工具栏`+`号
2. 在弹出对话框中选择：
   - **评审分支**：需要评审的Feature分支（例如：`feature/user-login`）
   - **基准分支**：对比的目标分支（例如：`master` 或 `develop`）
3. 点击 **"确定"** 创建会话

**提示**：
- 评审分支和基准分支必须已推送到远程仓库
- 系统会自动检查分支关系并给出警告

---

### 第三步：开始评审

1. **浏览文件列表**：在工具窗口中查看所有变更文件
2. **打开Diff视图**：双击文件名打开对比视图
3. **标记评审状态**：点击代码行号旁的图标切换状态
   - 🔵 未评审 → ✅ 通过 → ⚠️ 问题 → 🔵 未评审（循环）
4. **查看进度**：底部状态栏实时显示评审统计

---

### 第四步：添加评论（可选）🆕

为代码添加评论标记问题和建议：

1. **在 Diff 视图中右键选择"添加评论"**
2. **输入评论内容并保存**（最多 500 字符）
3. **点击评论图标查看和管理评论**
4. **使用评论列表视图集中管理**（工具栏"切换视图"）

💡 **提示**：详细使用方法请参见 [使用指南 - 评论系统使用](#评论系统使用-)

---

### 第五步：增量刷新

当评审分支有新提交时：

1. 点击工具栏的 **"刷新"** 按钮
2. 系统自动：
   - 计算新的diff
   - 保留已评审状态和评论
   - 标记新增/变更代码为"未评审"
3. 继续评审新增或变更的代码

---

## 📖 使用指南

### 工具栏操作说明

| 图标 | 操作 | 快捷键 | 说明 |
|------|------|-----|------|
| ➕ | 开始评审 | -   | 创建新的评审会话 |
| 🔄 | 刷新会话 | -   | 增量更新当前会话 |
| 🗑️ | 删除会话 | -   | 删除当前会话及所有数据 |
| ❌ | 关闭会话 | -   | 关闭会话但保留数据 |
| 🔀 | 切换视图 🆕 | -   | 在 Diff Block 列表和评论列表间切换 |
| 🔍 | 筛选 | -   | 按状态或变更类型筛选文件 |
| 📂 | 全部展开 | -   | 展开所有文件夹 |
| 📁 | 全部收起 | -   | 收起所有文件夹 |

---

### 文件树图标说明

#### 变更类型图标

- 🆕 **绿色加号** - 新增文件
- 📝 **蓝色修改** - 修改文件
- 🗑️ **红色删除** - 删除文件
- 🔄 **紫色箭头** - 重命名文件

#### 评审状态图标

- 🔵 **蓝色圆点** - 未评审
- ✅ **绿色对勾** - 评审通过
- ⚠️ **橙色警告** - 存在问题

#### 评论状态图标 🆕

**Diff 窗口 Gutter 区域**：
- 💬 **消息气泡图标** - 待处理评论
- ✓ **检查通过图标** - 无需处理评论
- ● **完成圆点图标** - 已处理评论
- 🌫️ **半透明效果** - 悬浮评论（关联的代码块已不存在）

**评论列表视图**：
- 🔵 **蓝色待办图标** - 待处理评论
- 🟠 **橙色警告图标** - 无需处理评论
- 🟢 **绿色对勾图标** - 已处理评论
- 🌫️ **灰色文本** - 悬浮评论

---

### 状态筛选

使用工具栏的筛选下拉框快速定位文件和评论：

**Diff Block 列表视图**：
- **全部** - 显示所有文件
- **未评审** - 仅显示未评审的文件
- **通过** - 仅显示评审通过的文件
- **问题** - 仅显示存在问题的文件

**评论列表视图**：
- **按评论状态筛选**：待处理、无需处理、已处理
- **按变更类型筛选**：新增、修改、删除、重命名
- **筛选规则**：文件包含任一匹配状态的评论即显示

---

### 统计面板说明

底部统计面板实时显示：

```
评审进度: 45/120 代码块 (37.5%)
  ✅ 已确认: 40
  ⚠️ 问题: 5
  🔵 未评审: 75
```

- **总代码块数** - 当前会话包含的所有diff代码块数量
- **已确认** - 标记为"通过"的代码块数量
- **问题** - 标记为"问题"的代码块数量
- **未评审** - 尚未处理的代码块数量
- **完成度** - (已确认 + 问题) / 总数 × 100%

---

## 🎯 适用场景

### ✅ 推荐场景

1. **Feature分支评审**
   - 合并到主分支前的代码评审
   - 确保代码质量符合团队标准

2. **大型分支评审**
   - 变更文件较多，需要分批次评审
   - 避免一次性评审导致遗漏

3. **持续更新分支**
   - 评审过程中分支持续更新
   - 利用增量评审避免重复劳动

4. **团队内部评审**
   - 个人评审后标记状态
   - 便于后续团队讨论和追溯

---

### ❌ 不推荐场景

1. **Pull Request平台**
   - 如果团队使用GitHub/GitLab的PR功能
   - 建议直接在平台上进行评审和讨论

2. **非Git项目**
   - 插件依赖Git仓库
   - SVN等其他版本控制系统不支持

3. **跨仓库对比**
   - 仅支持同一仓库内的分支对比
   - 不支持跨仓库的代码对比

---

## 🏗️ 技术架构

### 核心技术栈

- **开发语言**: Kotlin 1.9+
- **构建工具**: Gradle 8.5+ (Kotlin DSL)
- **平台SDK**: IntelliJ Platform SDK 2025.2.3
- **数据库**: SQLite JDBC
- **架构模式**: MVVM (ViewModel + UiState + Intent)

**隐私说明**: 所有数据仅存储在本地，不会上传到任何服务器。

---

## 🐛 问题反馈

### 遇到问题？

如果您在使用过程中遇到任何问题，欢迎通过以下方式反馈：

1. **邮件反馈**: zero_feedback@163.com
2. **插件评论**: 在JetBrains Marketplace插件页面留言

---

### 反馈内容建议

为了更快解决问题，请提供以下信息：

- **IDEA版本**: `Help` → `About` 中的版本号
- **插件版本**: `Settings` → `Plugins` 中的版本号
- **操作系统**: Windows / macOS / Linux 及版本
- **问题描述**: 详细描述问题出现的步骤
- **错误日志**: `Help` → `Show Log in Finder/Explorer`

---

## 📄 版权说明

**Code Review Plus** © 2026 Zero. All Rights Reserved.

本插件为专有软件，详细许可条款请查看 [LISENSE](https://github.com/aGVsbG8gd29ybGQh/code-review-plus/blob/main/LISENSE) 文件。

### 使用限制

未经授权不得：
- 反编译或逆向工程
- 修改或二次分发
- 移除版权声明

### 第三方组件

本软件使用了部分开源组件，详见 [THIRD_PARTY_LICENSES.md](THIRD_PARTY_LICENSES.md)。

主要包括：
- Carbon Icons (Apache 2.0) - 插件图标
- IntelliJ Platform SDK (Apache 2.0) - 开发框架
- SQLite JDBC (Apache 2.0) - 数据库驱动

---

## 🙏 致谢

感谢以下开源项目和技术：

- [IntelliJ Platform SDK](https://plugins.jetbrains.com/docs/intellij/welcome.html)
- [Kotlin](https://kotlinlang.org/)
- [SQLite](https://www.sqlite.org/)
- [Git](https://git-scm.com/)

---

<div align="center">

**如果您觉得这个插件有用，欢迎在Marketplace给予好评！⭐**

Made with ❤️ by Zero

</div>
